// map.pug

extends layout

block content
  .container
    h1 Store Map
    #map(style="height: 500px;")  // Contenedor del mapa
  script(src="https://unpkg.com/leaflet/dist/leaflet.js")
  link(rel="stylesheet", href="https://unpkg.com/leaflet/dist/leaflet.css")

  script.
    var map = L.map('map').setView([51.505, -0.09], 2);  // Inicializa el mapa en coordenadas por defecto (puedes cambiar esto más tarde)

    // Cargar un mapa base de OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Recorrer todas las tiendas y agregar un marcador para cada una
    var stores = !{JSON.stringify(stores)};  // Convertir los datos de la tienda a un objeto JavaScript

    stores.forEach(function(store) {
        if (store.lat && store.lon) {  // Verificamos que la tienda tenga coordenadas válidas
            var marker = L.marker([store.lat, store.lon]);  // Marcador con las coordenadas
            marker.bindPopup(`<b>${store.name}</b><br>${store.address}<br>Rating: ${store.rating ? store.rating.toFixed(1) : 'N/A'} stars`);
            marker.addTo(map);
        }
    });
